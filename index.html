<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financing Calculator</title>

  <!-- External stylesheet to prevent Chrome caching issues -->
  <link rel="stylesheet" href="style.css?v=11">
</head>

<body>

<div id="financing-calculator">

  <div class="calc-row">

    <label>
      <h4 class="calc-title">Purchase Amount ($)</h4>
      <input type="number" id="purchaseAmount" placeholder="ex. $10,000" min="100" step="100">
    </label>

    <label>
      <h4 class="calc-title">Term Length</h4>
      <select id="amortizationPeriod">
        <option value="60" selected>60 months</option>
      </select>
    </label>

    <label>
      <h4 class="calc-title">Program</h4>
      <select id="program">
        <option value="12|0" selected>12 months at 0.00%</option>
      </select>
    </label>

    <label>
      <h4 class="calc-title">Payment Frequency</h4>
      <select id="frequency">
        <option value="monthly" selected>Monthly</option>
        <option value="biweekly">Bi-Weekly</option>
        <option value="weekly">Weekly</option>
      </select>
    </label>

  </div>

  <button onclick="calculatePayment()">
    <div class="calc-icon"></div>
    <div class="calc-button-title">Calculate</div>
  </button>

  <div id="results">
    <p><strong>Payment Over Full Period (with interest):</strong> $<span id="fullPeriodPayment">0.00</span></p>
    <p><strong>Payment Within Deferral Period (0%):</strong> $<span id="deferralPayment">0.00</span></p>
    <p class="disclaimer">
      * Estimates only. Actual financing terms depend on credit approval.
    </p>
  </div>

</div>

<script>
const CONFIG = {
  partnerCostRate: 6.99
};

function calculatePayment() {
  const amount = parseFloat(document.getElementById('purchaseAmount').value);
  if (isNaN(amount) || amount <= 0) {
    alert("Please enter a valid purchase amount.");
    return;
  }

  const months = parseInt(document.getElementById('amortizationPeriod').value);
  const programParts = document.getElementById('program').value.split("|");
  const deferralMonths = parseInt(programParts[0]);
  const annualRate = parseFloat(programParts[1]);
  const frequency = document.getElementById('frequency').value;

  const financedAmount = amount * (1 + CONFIG.partnerCostRate / 100);

  let paymentsPerYear;
  if (frequency === "monthly") paymentsPerYear = 12;
  else if (frequency === "biweekly") paymentsPerYear = 26;
  else if (frequency === "weekly") paymentsPerYear = 52;

  const deferralPayments = (deferralMonths / 12) * paymentsPerYear;
  const deferralPayment = financedAmount / deferralPayments;

  const totalPayments = (months / 12) * paymentsPerYear;
  const periodicRate = annualRate / paymentsPerYear / 100;

  let fullPeriodPayment;
  if (annualRate === 0) {
    fullPeriodPayment = financedAmount / totalPayments;
  } else {
    fullPeriodPayment = (financedAmount * periodicRate) /
      (1 - Math.pow(1 + periodicRate, -totalPayments));
  }

  document.getElementById('fullPeriodPayment').innerText = fullPeriodPayment.toFixed(2);
  document.getElementById('deferralPayment').innerText = deferralPayment.toFixed(2);
}
</script>

</body>
</html>
